= Ktor Logging

image:https://www.travis-ci.org/Koriit/ktor-logging.svg?branch=master["Build Status", link="https://www.travis-ci.org/Koriit/ktor-logging"]
image:https://www.codefactor.io/repository/github/koriit/ktor-logging/badge[CodeFactor,link=https://www.codefactor.io/repository/github/koriit/ktor-logging]
image:https://img.shields.io/badge/code%20style-%E2%9D%A4-FF4081.svg[ktlint,link=https://ktlint.github.io/]

image:https://api.bintray.com/packages/koriit/kotlin/ktor-logging/images/download.svg[Download, link=https://bintray.com/koriit/kotlin/ktor-logging/_latestVersion]
image:https://img.shields.io/github/license/koriit/ktor-logging[GitHub]


Logging feature for ktor server.

== Extended logging with logback's logstash encoder
[source,kotlin]
----
override fun logPerformance(call: ApplicationCall) {
    val duration = System.currentTimeMillis() - call.attributes[startTimeKey]
    val route = call.attributes.getOrNull(routeKey)?.parent.toString()
    val method = call.request.httpMethod.value

    val requestInfo = mapOf(
            "method" to method,
            "protocol" to call.request.origin.version,
            "url" to call.request.origin.run { "$scheme://$host:$port$uri" },
            "api" to "$method $route",
            "route" to route,
            "remoteHost" to call.request.origin.remoteHost,
            "contentType" to call.request.contentType().toString(),
            "contentLength" to call.request.headers[HttpHeaders.ContentLength]?.toInt()
    )

    val responseInfo = mapOf(
            "status" to call.response.status()?.value,
            "contentType" to call.response.headers[HttpHeaders.ContentType],
            "contentLength" to call.response.headers[HttpHeaders.ContentLength]?.toInt()
    )

    val additionalInfo = mapOf(
            "request" to requestInfo,
            "response" to responseInfo
    )

    log.info("{} ms - {} - {} {}", value("duration", duration), responseInfo["status"], method, requestInfo["url"], appendEntries(additionalInfo))
}
----
